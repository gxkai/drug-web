webpackJsonp([53],{"Op/C":function(t,e){},PJKh:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("Dd8w"),i=s.n(a),n=s("NYxO"),c={name:"createFromCart",data:function(){return{name:"订单结算",account:this.$store.getters.account,cart:JSON.parse(this.$route.query.cart),deliveryType:this.$storage.get("deliveryType")||"SELF",payType:"KRCB",couponRecord:"",coupons:[],show:!1,payAmount:0,loading:!1}},components:{},created:function(){this.getData()},mounted:function(){this.$refs.content.style.height=document.documentElement.clientHeight-this.$refs.header.$el.clientHeight-this.$refs.footer.$el.clientHeight+"px",this.$refs.content.style.overflow="auto"},computed:i()({},Object(n.b)(["receiveAddress"])),methods:i()({getData:function(){var t=this;this.payAmount=this.cart.payAmount,this.isBlank(this.receiveAddress)&&this.$http.get("addresses/default").then(function(e){e.data&&t.setReceiveAddress(e.data)}).catch(function(e){t.exception(e)}),this.$http.get("couponRecords/order").then(function(e){t.coupons=e.data.filter(function(e){return t.cart.payAmount>=e.amount}),console.log(t.coupons)}).catch(function(e){t.exception(e)})},getCartIds:function(){var t=[];return this.cart.cartShops.forEach(function(e){e.rxs.forEach(function(e){e.drugs.forEach(function(e){t.push(e.cartId)})})}),t},onOrder:function(){var t=this;this.loading=!0;var e={};switch(this.deliveryType){case"DELIVERY":this.isBlank(this.receiveAddress)?this.$toast("请维护收货地址"):e.addressId=this.receiveAddress.id}e.cartIds=this.getCartIds(),e.deliveryType=this.deliveryType,e.payType=this.payType,this.$http.post("/orders",e).then(function(e){var s="";e.data.forEach(function(t){s+="orderIds="+t+"&"}),s=s.substring(0,s.length-1),t.$router.replace({path:"/orders/pay?"+s+"&deliveryType="+t.deliveryType})}).catch(function(e){t.loading=!1,t.exception(e)})},onDeliveryType:function(t){this.$storage.set("deliveryType",t),this.deliveryType=t},onPayType:function(t){this.payType=t}},Object(n.c)({setReceiveAddress:"SET_RECEIVE_ADDRESS"}))},r={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"pay_cart"},[s("van-nav-bar",{ref:"header",attrs:{title:t.$route.name,"left-arrow":""},on:{"click-left":function(e){t.$router.go(-1)}}}),t._v(" "),s("div",{ref:"content",staticClass:"pay_cart-content"},["DELIVERY"===t.deliveryType?s("div",{staticClass:"pay_cart-content-delivery",on:{click:t.linkToOrderAddress}},[t.isNotBlank(t.receiveAddress)?s("div",{staticClass:"pay_cart-content-delivery-address"},[t._m(0),t._v(" "),s("div",{staticClass:"pay_cart-content-delivery-address-center"},[s("div",{staticClass:"elps"},[s("span",[t._v("收货人:"+t._s(t.receiveAddress.consignee))]),t._v(" "),s("span",{staticClass:"ml-l-10"},[t._v(t._s(t.receiveAddress.phone))])]),t._v(" "),s("div",{staticClass:"elps"},[t._v("\n            收货地址:"+t._s(t.receiveAddress.address)+"\n          ")])]),t._v(" "),t._m(1)]):s("div",{staticClass:"pay_cart-content-delivery-no_address"},[t._v("\n        请维护地址>\n      ")]),t._v(" "),t._m(2)]):t._e(),t._v(" "),s("new-close-list",{staticClass:"new-close-list",attrs:{cartShops:t.cart.cartShops}}),t._v(" "),s("div",{staticClass:"pay_cart-content-delivery_type"},[t._m(3),t._v(" "),s("div",{staticClass:"pay_cart-content-delivery_type-content"},[s("span",{class:{active:"DELIVERY"==t.deliveryType},on:{click:function(e){e.stopPropagation(),t.onDeliveryType("DELIVERY")}}},[t._v("送货上门")]),t._v(" "),s("span",{class:{active:"SELF"==t.deliveryType},on:{click:function(e){e.stopPropagation(),t.onDeliveryType("SELF")}}},[t._v("上门自提")])])]),t._v(" "),s("div",{staticClass:"pay_cart-content-pay_amount"},[s("div",[s("span",[t._v("商品总额：")]),t._v(" "),s("span",[t._v("¥"+t._s(t.toFixedTwo(t.cart.amount)))])]),t._v(" "),s("div",[s("span",[t._v("医保扣除：")]),t._v(" "),s("span",[t._v("¥"+t._s(t.toFixedTwo(t.cart.medicaidAmount)))])]),t._v(" "),s("div",[s("span",[t._v("实际支付：")]),t._v(" "),s("span",[t._v("¥"+t._s(t.toFixedTwo(t.cart.payAmount)))])])]),t._v(" "),s("div",{staticClass:"pay_cart-content-medicaid"},[s("div",{staticClass:"pay_cart-content-medicaid-header"},[t._v("\n        医保信息\n      ")]),t._v(" "),s("div",{staticClass:"pay_cart-content-medicaid-content"},[t.isNotBlank(t.account.medicaidNumber)?s("div",{staticClass:"pay_cart-content-medicaid-content-card"},[s("div",[s("span",[t._v("会员姓名:")]),t._v(" "),s("span",[t._v(t._s(t.account.name))])]),t._v(" "),s("div",[s("span",[t._v("医保卡号:")]),t._v(" "),s("span",[t._v(t._s(t.account.medicaidNumber))])]),t._v(" "),t._m(4)]):s("div",{staticClass:"pay_cart-content-medicaid-content-no_card"},[s("span",{staticClass:"iconfont ic-qianbao"}),t._v(" "),s("a",{on:{click:t.linkToCardBind}},[t._v("去绑定医保卡")])])])])],1),t._v(" "),s("van-submit-bar",{ref:"footer",attrs:{price:100*t.payAmount,"button-text":"提交订单",loading:t.loading},on:{submit:t.onOrder}})],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"pay_cart-content-delivery-address-left"},[e("i",{staticClass:"iconfont ic-dizhi"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"pay_cart-content-delivery-address-right"},[e("i",{staticClass:"iconfont ic-youjiantou"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"pay_cart-content-delivery-bar"},[e("img",{attrs:{src:s("RugO")}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"pay_cart-content-delivery_type-header"},[e("div",[e("i",{staticClass:"iconfont ic-peisongfangshi"})]),this._v(" "),e("div",[this._v("配送方式")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("span",[this._v("卡内余额:")]),this._v(" "),e("span",[this._v("¥0")])])}]};var o=s("VU/8")(c,r,!1,function(t){s("Op/C")},"data-v-51ade4c6",null);e.default=o.exports}});